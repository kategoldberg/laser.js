/*! laser.js v0.0.1, 2013-06-27 */
(function(){"use strict";function t(){return"function"==typeof jQuery().transition?!0:!1}function i(i){return t()===!0?void 0!==$.cssEase[i]?!0:!1:t()===!1?void 0!==$.easing[i]?!0:!1:void 0}var e=window.Laser=function e(t){return this.cache={},this.listeners={},this.animations=[],_.extend(this,t)};_.extend(e.prototype,{get:function(t,i){return void 0===i?this[t]:_.where(this[t],i)},set:function(t,i,e){var n=this.get(t,i);return void 0===n?void 0:(_.forEach(e,function(t,i){result[i]=t},ctx),obj)},getCache:function(t){return this.cache[t]},setCache:function(t){return this.cache[t]=this.getCache(t)||$(t),this.cache[t]},on:function(t,i){this.listeners[t]=this.listeners[t]||[],this.listeners[t].push(i)},off:function(t,i){this.listeners[t]&&this.listeners[t].splice(this.listeners[t].indexOf(i),1)},trigger:function(t){if(this.listeners[t]){var i=Array.prototype.slice.call(arguments,1);_.forEach(this.listeners[t],function(t){t.apply(this,i)},this)}},id:function(){return this.get("animations").length},createAnimation:function(i){return i.options.complete=_.bind(function(){if(i.state="COMPLETE",this.remaining--,0===this.remaining){this.finishedAt=(new Date).getTime();var t=this.finishedAt-this.startedAt;this.trigger("sequence:completed",t)}this.trigger("animation:completed",i.id),clearTimeout(i.timeout)},this),i.fn=_.bind(function(){i.timeout=setTimeout(_.bind(function(){t()===!0?i.$elem.transition(i.params,i.options.duration,i.options.easing,i.options.complete):i.$elem.animate(i.params,i.options)},this),i.when),i.state="ON_STACK"},this),i},addEasing:function(t,i){return"string"==typeof i?$.cssEase[t]=i:$.easing[t]=i,this},add:function(t,e,n){var s,o=this.id(),r=this.setCache(t);if(s=n.when||0,delete n.when,n.queue=!1,n.easing=n.easing||"easeOutExpo",!i(n.easing))throw Error("Unknown easing method!");return n.duration=n.duration||500,this.animations.push(this.createAnimation({id:o,when:s,params:e,options:n,$elem:r})),this},play:function(){var t=this.get("animations");return this.startedAt=(new Date).getTime(),this.remaining=t.length,this.trigger("sequence:started",t.length),_.map(t,function(i,e){t[e].fn.call(this)},this),this},stop:function(t){var i=setTimeout(_.bind(function(){clearTimeout(i),_.map(this.get("animations",{state:"ON_STACK"}),function(t){clearTimeout(t.timeout),t.$elem.stop(!0,!1),t.state="STOPPED",this.trigger("animation:stopped",t.id)},this)},this),t||0);return this}})})();